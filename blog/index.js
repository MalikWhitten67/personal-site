var se=function(){let e=new URLSearchParams(window.location.search).get("id")||"No ID";if(e=="No ID")return u("div",null,u("p",null,"Oops"),u("p",null,"Looks like you're trying to access a blog post that doesn't exist."),u("p",null,u("a",{href:"/"},"Go back to the main page")));const[s,t]=this.useState("blog",localStorage.getItem("blog")&&JSON.parse(localStorage.getItem("blog"))[e]||{});this.useEffect(()=>{if(localStorage.getItem("blog")&&JSON.parse(localStorage.getItem("blog"))[e])return;f.collection("blog_pages").getOne(e).then((o)=>{let i=JSON.parse(localStorage.getItem("blog"))||{};i[e]=o,localStorage.setItem("blog",JSON.stringify(i)),t(o,"blog")})},[]),console.log(s);const n=(o)=>{let i=o.split(" ").length/200;return`${Math.round(i)} ${Math.round(i)>1?"minutes":"minute"}`};return u("div",{key:"blog",style:{fontFamily:"Arial"}},u("div",{className:"blog-head"},u("h1",{style:{fontSize:"2.5rem",fontWeight:"500"}},s.head||""),u("p",{style:{fontSize:"1.2rem",color:"gray"}},"Published on ",new Date(s.created).toDateString()||""," - time to read ",n(s.body||""))),u("br",null),u("div",{className:"blog-body"},u("p",null,s.body||"")),u("a",{href:"/"},"Go back to the main page"))};globalThis.isServer=typeof window==="undefined";var u=(e,s,...t)=>{if(typeof e==="function"){let n=new K;return n.render=e,n.render()}return{type:e,props:s||{},children:t||[]}},c={};class K{props;state;element;Mounted;effect;key;prevState;constructor(){this.key=Math.random().toString(36).substring(7),this.props={},c[this.key]={},this.state=c[this.key],this.effect=[],this.Mounted=!1,this.element=null}setState(e,s){c[this.key]={...this.state,...e},console.log(c[this.key]),this.forceUpdate(s)}useEffect(e,s){if(s.length===0&&this.Mounted&&this.effect.length===0)e(),this.effect.push(e);else for(let t=0;t<s.length;t++)if(this.effect[t]!==s[t])this.effect=s,e()}useState(e,s){if(!this.state[e])console.log(`State ${e} does not exist`),this.state[e]=s;window.onbeforeunload=()=>{sessionStorage.setItem("state",JSON.stringify({}))};const t=(o,i)=>{this.prevState={...this.state},this.state[e]=o,c[this.key]={...this.state},this.forceUpdate(i)},n=e;return[this.state[e],t,n]}useFetch(e,s){const{key:t}=s;if(console.log(t),!t)throw new Error("You must supply a key for the affected element in the options object");const n="loading_"+e,o="error"+e,i="_data"+e,r=c[this.key][n]!==void 0?c[this.key][n]:!0,d=c[this.key][o]||null,a=c[this.key][i]||null;if(r&&!d&&!a)c[this.key][n]=!0,fetch(e,s).then((l)=>l.json()).then((l)=>{c[this.key][i]=l,c[this.key][n]=!1,this.forceUpdate(t)}).catch((l)=>{c[this.key][o]=l,c[this.key][n]=!1,this.forceUpdate(t)});return[a,r,d]}forceUpdate(e){let s=Array.from(document.querySelectorAll("*")).filter((n)=>{return n.key===e})[0],t=this.parseToElement(this.render());if(t.key!==e)t=Array.from(t.children).filter((n)=>n.key===e)[0];if(this.Reconciler.shouldUpdate(s,t))s.replaceWith(t)}Reconciler={shouldUpdate(e,s){if(e.outerHTML===s.outerHTML)return!1;let t=e.attributes,n=s.attributes;for(let o=0;o<t.length;o++){let i=t[o];if(i.name==="key")continue;if(i.name==="class"){if(i.value!==s.className)return!0;continue}if(i.value!==n[i.name])return!0}return!0}};parseToElement=(e)=>{if(!e)return document.createElement("div");let s=document.createElement(e.type);if(typeof e==="string"||typeof e==="number"||typeof e==="boolean")s.textContent=e;else{let{props:t,children:n}=e;for(let o in t){if(o==="key"){s.key=t[o];continue}if(o==="className"){s.className=t[o];continue}if(o==="style"){for(let i in t[o])s.style[i]=t[o][i];continue}if(o.startsWith("on")){console.log(o.substring(2).toLowerCase()),s.addEventListener(o.substring(2).toLowerCase(),t[o]);continue}s.setAttribute(o,t[o])}for(let o=0;o<n.length;o++){let i=n[o];if(Array.isArray(i))i.forEach((r)=>{s.appendChild(this.parseToElement(r))});if(typeof i==="function")s.appendChild(this.parseToElement(i()));else if(typeof i==="object")s.appendChild(this.parseToElement(i));else{let r=document.createElement("span");r.innerHTML=i,s.appendChild(r)}}}return s};e(e,s,...t){if(typeof e==="function")return e();return{type:e,props:s||{},children:t||[]}}toElement(){let e=this.render();return this.parseToElement(e)}render(){return""}}var q=function(e,s){const t={};if(typeof e!="string")return t;const n=Object.assign({},s||{}).decode||N;let o=0;for(;o<e.length;){const i=e.indexOf("=",o);if(i===-1)break;let r=e.indexOf(";",o);if(r===-1)r=e.length;else if(r<i){o=e.lastIndexOf(";",i-1)+1;continue}const d=e.slice(o,i).trim();if(t[d]===void 0){let a=e.slice(i+1,r).trim();a.charCodeAt(0)===34&&(a=a.slice(1,-1));try{t[d]=n(a)}catch(l){t[d]=a}}o=r+1}return t},P=function(e,s,t){const n=Object.assign({},t||{}),o=n.encode||M;if(!R.test(e))throw new TypeError("argument name is invalid");const i=o(s);if(i&&!R.test(i))throw new TypeError("argument val is invalid");let r=e+"="+i;if(n.maxAge!=null){const d=n.maxAge-0;if(isNaN(d)||!isFinite(d))throw new TypeError("option maxAge is invalid");r+="; Max-Age="+Math.floor(d)}if(n.domain){if(!R.test(n.domain))throw new TypeError("option domain is invalid");r+="; Domain="+n.domain}if(n.path){if(!R.test(n.path))throw new TypeError("option path is invalid");r+="; Path="+n.path}if(n.expires){if(!function d(a){return Object.prototype.toString.call(a)==="[object Date]"||a instanceof Date}(n.expires)||isNaN(n.expires.valueOf()))throw new TypeError("option expires is invalid");r+="; Expires="+n.expires.toUTCString()}if(n.httpOnly&&(r+="; HttpOnly"),n.secure&&(r+="; Secure"),n.priority)switch(typeof n.priority=="string"?n.priority.toLowerCase():n.priority){case"low":r+="; Priority=Low";break;case"medium":r+="; Priority=Medium";break;case"high":r+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}if(n.sameSite)switch(typeof n.sameSite=="string"?n.sameSite.toLowerCase():n.sameSite){case!0:r+="; SameSite=Strict";break;case"lax":r+="; SameSite=Lax";break;case"strict":r+="; SameSite=Strict";break;case"none":r+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return r},N=function(e){return e.indexOf("%")!==-1?decodeURIComponent(e):e},M=function(e){return encodeURIComponent(e)},v=function(e){if(e)try{const s=decodeURIComponent(h(e.split(".")[1]).split("").map(function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(s)||{}}catch(s){}return{}},F=function(e,s=0){let t=v(e);return!(Object.keys(t).length>0&&(!t.exp||t.exp-s>Date.now()/1000))},p=function(e,s,t,n){const o=n!==void 0;return o||t!==void 0?o?(console.warn(e),s.body=Object.assign({},s.body,t),s.query=Object.assign({},s.query,n),s):Object.assign(s,t):s},B=function(e){e._resetAutoRefresh?.()},U=function(e){if(e){e.query=e.query||{};for(let s in e)j.includes(s)||(e.query[s]=e[s],delete e[s])}},x=function(e){if(typeof window=="undefined"||!window?.open)throw new m(new Error("Not in a browser context - please pass a custom urlCallback function."));let s=1024,t=768,n=window.innerWidth,o=window.innerHeight;s=s>n?n:s,t=t>o?o:t;let i=n/2-s/2,r=o/2-t/2;return window.open(e,"popup_window","width="+s+",height="+t+",top="+r+",left="+i+",resizable,menubar=no")};class m extends Error{constructor(e){super("ClientResponseError"),this.url="",this.status=0,this.response={},this.isAbort=!1,this.originalError=null,Object.setPrototypeOf(this,m.prototype),e!==null&&typeof e=="object"&&(this.url=typeof e.url=="string"?e.url:"",this.status=typeof e.status=="number"?e.status:0,this.isAbort=!!e.isAbort,this.originalError=e.originalError,e.response!==null&&typeof e.response=="object"?this.response=e.response:e.data!==null&&typeof e.data=="object"?this.response=e.data:this.response={}),this.originalError||e instanceof m||(this.originalError=e),typeof DOMException!="undefined"&&e instanceof DOMException&&(this.isAbort=!0),this.name="ClientResponseError "+this.status,this.message=this.response?.message,this.message||(this.isAbort?this.message="The request was autocancelled. You can find more info in https://github.com/pocketbase/js-sdk#auto-cancellation.":this.originalError?.cause?.message?.includes("ECONNREFUSED ::1")?this.message="Failed to connect to the PocketBase server. Try changing the SDK URL from localhost to 127.0.0.1 (https://github.com/pocketbase/js-sdk/issues/21).":this.message="Something went wrong while processing your request.")}get data(){return this.response}toJSON(){return{...this}}}var R=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,h;h=typeof atob=="function"?atob:(e)=>{let s=String(e).replace(/=+$/,"");if(s.length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,n,o=0,i=0,r="";n=s.charAt(i++);~n&&(t=o%4?64*t+n:n,o++%4)?r+=String.fromCharCode(255&t>>(-2*o&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return r};var z="pb_auth";class H{constructor(){this.baseToken="",this.baseModel=null,this._onChangeCallbacks=[]}get token(){return this.baseToken}get model(){return this.baseModel}get isValid(){return!F(this.token)}get isAdmin(){return v(this.token).type==="admin"}get isAuthRecord(){return v(this.token).type==="authRecord"}save(e,s){this.baseToken=e||"",this.baseModel=s||null,this.triggerChange()}clear(){this.baseToken="",this.baseModel=null,this.triggerChange()}loadFromCookie(e,s=z){const t=q(e||"")[s]||"";let n={};try{n=JSON.parse(t),(typeof n===null||typeof n!="object"||Array.isArray(n))&&(n={})}catch(o){}this.save(n.token||"",n.model||null)}exportToCookie(e,s=z){const t={secure:!0,sameSite:!0,httpOnly:!0,path:"/"},n=v(this.token);t.expires=n?.exp?new Date(1000*n.exp):new Date("1970-01-01"),e=Object.assign({},t,e);const o={token:this.token,model:this.model?JSON.parse(JSON.stringify(this.model)):null};let i=P(s,JSON.stringify(o),e);const r=typeof Blob!="undefined"?new Blob([i]).size:i.length;if(o.model&&r>4096){o.model={id:o?.model?.id,email:o?.model?.email};const d=["collectionId","username","verified"];for(let a in this.model)d.includes(a)&&(o.model[a]=this.model[a]);i=P(s,JSON.stringify(o),e)}return i}onChange(e,s=!1){return this._onChangeCallbacks.push(e),s&&e(this.token,this.model),()=>{for(let t=this._onChangeCallbacks.length-1;t>=0;t--)if(this._onChangeCallbacks[t]==e)return delete this._onChangeCallbacks[t],void this._onChangeCallbacks.splice(t,1)}}triggerChange(){for(let e of this._onChangeCallbacks)e&&e(this.token,this.model)}}class X extends H{constructor(e="pocketbase_auth"){super(),this.storageFallback={},this.storageKey=e,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get model(){return(this._storageGet(this.storageKey)||{}).model||null}save(e,s){this._storageSet(this.storageKey,{token:e,model:s}),super.save(e,s)}clear(){this._storageRemove(this.storageKey),super.clear()}_storageGet(e){if(typeof window!="undefined"&&window?.localStorage){const s=window.localStorage.getItem(e)||"";try{return JSON.parse(s)}catch(t){return s}}return this.storageFallback[e]}_storageSet(e,s){if(typeof window!="undefined"&&window?.localStorage){let t=s;typeof s!="string"&&(t=JSON.stringify(s)),window.localStorage.setItem(e,t)}else this.storageFallback[e]=s}_storageRemove(e){typeof window!="undefined"&&window?.localStorage&&window.localStorage?.removeItem(e),delete this.storageFallback[e]}_bindStorageEvent(){typeof window!="undefined"&&window?.localStorage&&window.addEventListener&&window.addEventListener("storage",(e)=>{if(e.key!=this.storageKey)return;const s=this._storageGet(this.storageKey)||{};super.save(s.token||"",s.model||null)})}}class C{constructor(e){this.client=e}}class Y extends C{async getAll(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/settings",e)}async update(e,s){return s=Object.assign({method:"PATCH",body:e},s),this.client.send("/api/settings",s)}async testS3(e="storage",s){return s=Object.assign({method:"POST",body:{filesystem:e}},s),this.client.send("/api/settings/test/s3",s).then(()=>!0)}async testEmail(e,s,t){return t=Object.assign({method:"POST",body:{email:e,template:s}},t),this.client.send("/api/settings/test/email",t).then(()=>!0)}async generateAppleClientSecret(e,s,t,n,o,i){return i=Object.assign({method:"POST",body:{clientId:e,teamId:s,keyId:t,privateKey:n,duration:o}},i),this.client.send("/api/settings/apple/generate-client-secret",i)}}class T extends C{decode(e){return e}async getFullList(e,s){if(typeof e=="number")return this._getFullList(e,s);let t=500;return(s=Object.assign({},e,s)).batch&&(t=s.batch,delete s.batch),this._getFullList(t,s)}async getList(e=1,s=30,t){return(t=Object.assign({method:"GET"},t)).query=Object.assign({page:e,perPage:s},t.query),this.client.send(this.baseCrudPath,t).then((n)=>(n.items=n.items?.map((o)=>this.decode(o))||[],n))}async getFirstListItem(e,s){return(s=Object.assign({requestKey:"one_by_filter_"+this.baseCrudPath+"_"+e},s)).query=Object.assign({filter:e,skipTotal:1},s.query),this.getList(1,1,s).then((t)=>{if(!t?.items?.length)throw new m({status:404,response:{code:404,message:"The requested resource wasn't found.",data:{}}});return t.items[0]})}async getOne(e,s){if(!e)throw new m({url:this.client.buildUrl(this.baseCrudPath+"/"),status:404,response:{code:404,message:"Missing required record id.",data:{}}});return s=Object.assign({method:"GET"},s),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),s).then((t)=>this.decode(t))}async create(e,s){return s=Object.assign({method:"POST",body:e},s),this.client.send(this.baseCrudPath,s).then((t)=>this.decode(t))}async update(e,s,t){return t=Object.assign({method:"PATCH",body:s},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then((n)=>this.decode(n))}async delete(e,s){return s=Object.assign({method:"DELETE"},s),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),s).then(()=>!0)}_getFullList(e=500,s){(s=s||{}).query=Object.assign({skipTotal:1},s.query);let t=[],n=async(o)=>this.getList(o,e||500,s).then((i)=>{const r=i.items;return t=t.concat(r),r.length==i.perPage?n(o+1):t});return n(1)}}class V extends T{get baseCrudPath(){return"/api/admins"}async update(e,s,t){return super.update(e,s,t).then((n)=>(this.client.authStore.model?.id===n.id&&this.client.authStore.model?.collectionId===void 0&&this.client.authStore.save(this.client.authStore.token,n),n))}async delete(e,s){return super.delete(e,s).then((t)=>(t&&this.client.authStore.model?.id===e&&this.client.authStore.model?.collectionId===void 0&&this.client.authStore.clear(),t))}authResponse(e){const s=this.decode(e?.admin||{});return e?.token&&e?.admin&&this.client.authStore.save(e.token,s),Object.assign({},e,{token:e?.token||"",admin:s})}async authWithPassword(e,s,t,n){let o={method:"POST",body:{identity:e,password:s}};o=p("This form of authWithPassword(email, pass, body?, query?) is deprecated. Consider replacing it with authWithPassword(email, pass, options?).",o,t,n);const i=o.autoRefreshThreshold;delete o.autoRefreshThreshold,o.autoRefresh||B(this.client);let r=await this.client.send(this.baseCrudPath+"/auth-with-password",o);return r=this.authResponse(r),i&&function d(a,l,I,g){B(a);const y=a.beforeSend,b=a.authStore.model,L=a.authStore.onChange((A,w)=>{(!A||w?.id!=b?.id||(w?.collectionId||b?.collectionId)&&w?.collectionId!=b?.collectionId)&&B(a)});a._resetAutoRefresh=function(){L(),a.beforeSend=y,delete a._resetAutoRefresh},a.beforeSend=async(A,w)=>{const W=a.authStore.token;if(w.query?.autoRefresh)return y?y(A,w):{url:A,sendOptions:w};let k=a.authStore.isValid;if(k&&F(a.authStore.token,l))try{await I()}catch(E){k=!1}k||await g();const S=w.headers||{};for(let E in S)if(E.toLowerCase()=="authorization"&&W==S[E]&&a.authStore.token){S[E]=a.authStore.token;break}return w.headers=S,y?y(A,w):{url:A,sendOptions:w}}}(this.client,i,()=>this.authRefresh({autoRefresh:!0}),()=>this.authWithPassword(e,s,Object.assign({autoRefresh:!0},o))),r}async authRefresh(e,s){let t={method:"POST"};return t=p("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",t,e,s),this.client.send(this.baseCrudPath+"/auth-refresh",t).then(this.authResponse.bind(this))}async requestPasswordReset(e,s,t){let n={method:"POST",body:{email:e}};return n=p("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",n,s,t),this.client.send(this.baseCrudPath+"/request-password-reset",n).then(()=>!0)}async confirmPasswordReset(e,s,t,n,o){let i={method:"POST",body:{token:e,password:s,passwordConfirm:t}};return i=p("This form of confirmPasswordReset(resetToken, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(resetToken, password, passwordConfirm, options?).",i,n,o),this.client.send(this.baseCrudPath+"/confirm-password-reset",i).then(()=>!0)}}var j=["requestKey","$cancelKey","$autoCancel","fetch","headers","body","query","params","cache","credentials","headers","integrity","keepalive","method","mode","redirect","referrer","referrerPolicy","signal","window"];class O extends C{constructor(){super(...arguments),this.clientId="",this.eventSource=null,this.subscriptions={},this.lastSentSubscriptions=[],this.maxConnectTimeout=15000,this.reconnectAttempts=0,this.maxReconnectAttempts=Infinity,this.predefinedReconnectIntervals=[200,300,500,1000,1200,1500,2000],this.pendingConnects=[]}get isConnected(){return!!this.eventSource&&!!this.clientId&&!this.pendingConnects.length}async subscribe(e,s,t){if(!e)throw new Error("topic must be set.");let n=e;if(t){U(t);const i="options="+encodeURIComponent(JSON.stringify({query:t.query,headers:t.headers}));n+=(n.includes("?")?"&":"?")+i}const o=function(i){const r=i;let d;try{d=JSON.parse(r?.data)}catch{}s(d||{})};return this.subscriptions[n]||(this.subscriptions[n]=[]),this.subscriptions[n].push(o),this.isConnected?this.subscriptions[n].length===1?await this.submitSubscriptions():this.eventSource?.addEventListener(n,o):await this.connect(),async()=>this.unsubscribeByTopicAndListener(e,o)}async unsubscribe(e){let s=!1;if(e){const t=this.getSubscriptionsByTopic(e);for(let n in t)if(this.hasSubscriptionListeners(n)){for(let o of this.subscriptions[n])this.eventSource?.removeEventListener(n,o);delete this.subscriptions[n],s||(s=!0)}}else this.subscriptions={};this.hasSubscriptionListeners()?s&&await this.submitSubscriptions():this.disconnect()}async unsubscribeByPrefix(e){let s=!1;for(let t in this.subscriptions)if((t+"?").startsWith(e)){s=!0;for(let n of this.subscriptions[t])this.eventSource?.removeEventListener(t,n);delete this.subscriptions[t]}s&&(this.hasSubscriptionListeners()?await this.submitSubscriptions():this.disconnect())}async unsubscribeByTopicAndListener(e,s){let t=!1;const n=this.getSubscriptionsByTopic(e);for(let o in n){if(!Array.isArray(this.subscriptions[o])||!this.subscriptions[o].length)continue;let i=!1;for(let r=this.subscriptions[o].length-1;r>=0;r--)this.subscriptions[o][r]===s&&(i=!0,delete this.subscriptions[o][r],this.subscriptions[o].splice(r,1),this.eventSource?.removeEventListener(o,s));i&&(this.subscriptions[o].length||delete this.subscriptions[o],t||this.hasSubscriptionListeners(o)||(t=!0))}this.hasSubscriptionListeners()?t&&await this.submitSubscriptions():this.disconnect()}hasSubscriptionListeners(e){if(this.subscriptions=this.subscriptions||{},e)return!!this.subscriptions[e]?.length;for(let s in this.subscriptions)if(this.subscriptions[s]?.length)return!0;return!1}async submitSubscriptions(){if(this.clientId)return this.addAllSubscriptionListeners(),this.lastSentSubscriptions=this.getNonEmptySubscriptionKeys(),this.client.send("/api/realtime",{method:"POST",body:{clientId:this.clientId,subscriptions:this.lastSentSubscriptions},requestKey:this.getSubscriptionsCancelKey()}).catch((e)=>{if(!e?.isAbort)throw e})}getSubscriptionsCancelKey(){return"realtime_"+this.clientId}getSubscriptionsByTopic(e){const s={};e=e.includes("?")?e:e+"?";for(let t in this.subscriptions)(t+"?").startsWith(e)&&(s[t]=this.subscriptions[t]);return s}getNonEmptySubscriptionKeys(){const e=[];for(let s in this.subscriptions)this.subscriptions[s].length&&e.push(s);return e}addAllSubscriptionListeners(){if(this.eventSource){this.removeAllSubscriptionListeners();for(let e in this.subscriptions)for(let s of this.subscriptions[e])this.eventSource.addEventListener(e,s)}}removeAllSubscriptionListeners(){if(this.eventSource)for(let e in this.subscriptions)for(let s of this.subscriptions[e])this.eventSource.removeEventListener(e,s)}async connect(){if(!(this.reconnectAttempts>0))return new Promise((e,s)=>{this.pendingConnects.push({resolve:e,reject:s}),this.pendingConnects.length>1||this.initConnect()})}initConnect(){this.disconnect(!0),clearTimeout(this.connectTimeoutId),this.connectTimeoutId=setTimeout(()=>{this.connectErrorHandler(new Error("EventSource connect took too long."))},this.maxConnectTimeout),this.eventSource=new EventSource(this.client.buildUrl("/api/realtime")),this.eventSource.onerror=(e)=>{this.connectErrorHandler(new Error("Failed to establish realtime connection."))},this.eventSource.addEventListener("PB_CONNECT",(e)=>{const s=e;this.clientId=s?.lastEventId,this.submitSubscriptions().then(async()=>{let t=3;for(;this.hasUnsentSubscriptions()&&t>0;)t--,await this.submitSubscriptions()}).then(()=>{for(let n of this.pendingConnects)n.resolve();this.pendingConnects=[],this.reconnectAttempts=0,clearTimeout(this.reconnectTimeoutId),clearTimeout(this.connectTimeoutId);const t=this.getSubscriptionsByTopic("PB_CONNECT");for(let n in t)for(let o of t[n])o(e)}).catch((t)=>{this.clientId="",this.connectErrorHandler(t)})})}hasUnsentSubscriptions(){const e=this.getNonEmptySubscriptionKeys();if(e.length!=this.lastSentSubscriptions.length)return!0;for(let s of e)if(!this.lastSentSubscriptions.includes(s))return!0;return!1}connectErrorHandler(e){if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),!this.clientId&&!this.reconnectAttempts||this.reconnectAttempts>this.maxReconnectAttempts){for(let t of this.pendingConnects)t.reject(new m(e));return this.pendingConnects=[],void this.disconnect()}this.disconnect(!0);const s=this.predefinedReconnectIntervals[this.reconnectAttempts]||this.predefinedReconnectIntervals[this.predefinedReconnectIntervals.length-1];this.reconnectAttempts++,this.reconnectTimeoutId=setTimeout(()=>{this.initConnect()},s)}disconnect(e=!1){if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),this.removeAllSubscriptionListeners(),this.client.cancelRequest(this.getSubscriptionsCancelKey()),this.eventSource?.close(),this.eventSource=null,this.clientId="",!e){this.reconnectAttempts=0;for(let s of this.pendingConnects)s.resolve();this.pendingConnects=[]}}}class G extends T{constructor(e,s){super(e),this.collectionIdOrName=s}get baseCrudPath(){return this.baseCollectionPath+"/records"}get baseCollectionPath(){return"/api/collections/"+encodeURIComponent(this.collectionIdOrName)}async subscribe(e,s,t){if(!e)throw new Error("Missing topic.");if(!s)throw new Error("Missing subscription callback.");return this.client.realtime.subscribe(this.collectionIdOrName+"/"+e,s,t)}async unsubscribe(e){return e?this.client.realtime.unsubscribe(this.collectionIdOrName+"/"+e):this.client.realtime.unsubscribeByPrefix(this.collectionIdOrName)}async getFullList(e,s){if(typeof e=="number")return super.getFullList(e,s);const t=Object.assign({},e,s);return super.getFullList(t)}async getList(e=1,s=30,t){return super.getList(e,s,t)}async getFirstListItem(e,s){return super.getFirstListItem(e,s)}async getOne(e,s){return super.getOne(e,s)}async create(e,s){return super.create(e,s)}async update(e,s,t){return super.update(e,s,t).then((n)=>(this.client.authStore.model?.id!==n?.id||this.client.authStore.model?.collectionId!==this.collectionIdOrName&&this.client.authStore.model?.collectionName!==this.collectionIdOrName||this.client.authStore.save(this.client.authStore.token,n),n))}async delete(e,s){return super.delete(e,s).then((t)=>(!t||this.client.authStore.model?.id!==e||this.client.authStore.model?.collectionId!==this.collectionIdOrName&&this.client.authStore.model?.collectionName!==this.collectionIdOrName||this.client.authStore.clear(),t))}authResponse(e){const s=this.decode(e?.record||{});return this.client.authStore.save(e?.token,s),Object.assign({},e,{token:e?.token||"",record:s})}async listAuthMethods(e){return e=Object.assign({method:"GET"},e),this.client.send(this.baseCollectionPath+"/auth-methods",e).then((s)=>Object.assign({},s,{usernamePassword:!!s?.usernamePassword,emailPassword:!!s?.emailPassword,authProviders:Array.isArray(s?.authProviders)?s?.authProviders:[]}))}async authWithPassword(e,s,t,n){let o={method:"POST",body:{identity:e,password:s}};return o=p("This form of authWithPassword(usernameOrEmail, pass, body?, query?) is deprecated. Consider replacing it with authWithPassword(usernameOrEmail, pass, options?).",o,t,n),this.client.send(this.baseCollectionPath+"/auth-with-password",o).then((i)=>this.authResponse(i))}async authWithOAuth2Code(e,s,t,n,o,i,r){let d={method:"POST",body:{provider:e,code:s,codeVerifier:t,redirectUrl:n,createData:o}};return d=p("This form of authWithOAuth2Code(provider, code, codeVerifier, redirectUrl, createData?, body?, query?) is deprecated. Consider replacing it with authWithOAuth2Code(provider, code, codeVerifier, redirectUrl, createData?, options?).",d,i,r),this.client.send(this.baseCollectionPath+"/auth-with-oauth2",d).then((a)=>this.authResponse(a))}async authWithOAuth2(...e){if(e.length>1||typeof e?.[0]=="string")return console.warn("PocketBase: This form of authWithOAuth2() is deprecated and may get removed in the future. Please replace with authWithOAuth2Code() OR use the authWithOAuth2() realtime form as shown in https://pocketbase.io/docs/authentication/#oauth2-integration."),this.authWithOAuth2Code(e?.[0]||"",e?.[1]||"",e?.[2]||"",e?.[3]||"",e?.[4]||{},e?.[5]||{},e?.[6]||{});const s=e?.[0]||{},t=(await this.listAuthMethods()).authProviders.find((d)=>d.name===s.provider);if(!t)throw new m(new Error(`Missing or invalid provider "${s.provider}".`));const n=this.client.buildUrl("/api/oauth2-redirect"),o=new O(this.client);let i=null;function r(){i?.close(),o.unsubscribe()}return s.urlCallback||(i=x(void 0)),new Promise(async(d,a)=>{try{await o.subscribe("@oauth2",async(g)=>{const y=o.clientId;try{if(!g.state||y!==g.state)throw new Error("State parameters don't match.");if(g.error||!g.code)throw new Error("OAuth2 redirect error or missing code: "+g.error);const b=Object.assign({},s);delete b.provider,delete b.scopes,delete b.createData,delete b.urlCallback;const L=await this.authWithOAuth2Code(t.name,g.code,t.codeVerifier,n,s.createData,b);d(L)}catch(b){a(new m(b))}r()});const l={state:o.clientId};s.scopes?.length&&(l.scope=s.scopes.join(" "));const I=this._replaceQueryParams(t.authUrl+n,l);await(s.urlCallback||function(g){i?i.location.href=g:i=x(g)})(I)}catch(l){r(),a(new m(l))}})}async authRefresh(e,s){let t={method:"POST"};return t=p("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",t,e,s),this.client.send(this.baseCollectionPath+"/auth-refresh",t).then((n)=>this.authResponse(n))}async requestPasswordReset(e,s,t){let n={method:"POST",body:{email:e}};return n=p("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",n,s,t),this.client.send(this.baseCollectionPath+"/request-password-reset",n).then(()=>!0)}async confirmPasswordReset(e,s,t,n,o){let i={method:"POST",body:{token:e,password:s,passwordConfirm:t}};return i=p("This form of confirmPasswordReset(token, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(token, password, passwordConfirm, options?).",i,n,o),this.client.send(this.baseCollectionPath+"/confirm-password-reset",i).then(()=>!0)}async requestVerification(e,s,t){let n={method:"POST",body:{email:e}};return n=p("This form of requestVerification(email, body?, query?) is deprecated. Consider replacing it with requestVerification(email, options?).",n,s,t),this.client.send(this.baseCollectionPath+"/request-verification",n).then(()=>!0)}async confirmVerification(e,s,t){let n={method:"POST",body:{token:e}};return n=p("This form of confirmVerification(token, body?, query?) is deprecated. Consider replacing it with confirmVerification(token, options?).",n,s,t),this.client.send(this.baseCollectionPath+"/confirm-verification",n).then(()=>{const o=v(e),i=this.client.authStore.model;return i&&!i.verified&&i.id===o.id&&i.collectionId===o.collectionId&&(i.verified=!0,this.client.authStore.save(this.client.authStore.token,i)),!0})}async requestEmailChange(e,s,t){let n={method:"POST",body:{newEmail:e}};return n=p("This form of requestEmailChange(newEmail, body?, query?) is deprecated. Consider replacing it with requestEmailChange(newEmail, options?).",n,s,t),this.client.send(this.baseCollectionPath+"/request-email-change",n).then(()=>!0)}async confirmEmailChange(e,s,t,n){let o={method:"POST",body:{token:e,password:s}};return o=p("This form of confirmEmailChange(token, password, body?, query?) is deprecated. Consider replacing it with confirmEmailChange(token, password, options?).",o,t,n),this.client.send(this.baseCollectionPath+"/confirm-email-change",o).then(()=>{const i=v(e),r=this.client.authStore.model;return r&&r.id===i.id&&r.collectionId===i.collectionId&&this.client.authStore.clear(),!0})}async listExternalAuths(e,s){return s=Object.assign({method:"GET"},s),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/external-auths",s)}async unlinkExternalAuth(e,s,t){return t=Object.assign({method:"DELETE"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/external-auths/"+encodeURIComponent(s),t).then(()=>!0)}_replaceQueryParams(e,s={}){let t=e,n="";e.indexOf("?")>=0&&(t=e.substring(0,e.indexOf("?")),n=e.substring(e.indexOf("?")+1));const o={},i=n.split("&");for(let r of i){if(r=="")continue;const d=r.split("=");o[decodeURIComponent(d[0].replace(/\+/g," "))]=decodeURIComponent((d[1]||"").replace(/\+/g," "))}for(let r in s)s.hasOwnProperty(r)&&(s[r]==null?delete o[r]:o[r]=s[r]);n="";for(let r in o)o.hasOwnProperty(r)&&(n!=""&&(n+="&"),n+=encodeURIComponent(r.replace(/%20/g,"+"))+"="+encodeURIComponent(o[r].replace(/%20/g,"+")));return n!=""?t+"?"+n:t}}class Q extends T{get baseCrudPath(){return"/api/collections"}async import(e,s=!1,t){return t=Object.assign({method:"PUT",body:{collections:e,deleteMissing:s}},t),this.client.send(this.baseCrudPath+"/import",t).then(()=>!0)}}class $ extends C{async getList(e=1,s=30,t){return(t=Object.assign({method:"GET"},t)).query=Object.assign({page:e,perPage:s},t.query),this.client.send("/api/logs",t)}async getOne(e,s){if(!e)throw new m({url:this.client.buildUrl("/api/logs/"),status:404,response:{code:404,message:"Missing required log id.",data:{}}});return s=Object.assign({method:"GET"},s),this.client.send("/api/logs/"+encodeURIComponent(e),s)}async getStats(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/logs/stats",e)}}class D extends C{async check(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/health",e)}}class J extends C{getUrl(e,s,t={}){if(!s||!e?.id||!e?.collectionId&&!e?.collectionName)return"";const n=[];n.push("api"),n.push("files"),n.push(encodeURIComponent(e.collectionId||e.collectionName)),n.push(encodeURIComponent(e.id)),n.push(encodeURIComponent(s));let o=this.client.buildUrl(n.join("/"));if(Object.keys(t).length){t.download===!1&&delete t.download;const i=new URLSearchParams(t);o+=(o.includes("?")?"&":"?")+i}return o}async getToken(e){return e=Object.assign({method:"POST"},e),this.client.send("/api/files/token",e).then((s)=>s?.token||"")}}class Z extends C{async getFullList(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/backups",e)}async create(e,s){return s=Object.assign({method:"POST",body:{name:e}},s),this.client.send("/api/backups",s).then(()=>!0)}async upload(e,s){return s=Object.assign({method:"POST",body:e},s),this.client.send("/api/backups/upload",s).then(()=>!0)}async delete(e,s){return s=Object.assign({method:"DELETE"},s),this.client.send(`/api/backups/${encodeURIComponent(e)}`,s).then(()=>!0)}async restore(e,s){return s=Object.assign({method:"POST"},s),this.client.send(`/api/backups/${encodeURIComponent(e)}/restore`,s).then(()=>!0)}getDownloadUrl(e,s){return this.client.buildUrl(`/api/backups/${encodeURIComponent(s)}?token=${encodeURIComponent(e)}`)}}class _{constructor(e="/",s,t="en-US"){this.cancelControllers={},this.recordServices={},this.enableAutoCancellation=!0,this.baseUrl=e,this.lang=t,this.authStore=s||new X,this.admins=new V(this),this.collections=new Q(this),this.files=new J(this),this.logs=new $(this),this.settings=new Y(this),this.realtime=new O(this),this.health=new D(this),this.backups=new Z(this)}collection(e){return this.recordServices[e]||(this.recordServices[e]=new G(this,e)),this.recordServices[e]}autoCancellation(e){return this.enableAutoCancellation=!!e,this}cancelRequest(e){return this.cancelControllers[e]&&(this.cancelControllers[e].abort(),delete this.cancelControllers[e]),this}cancelAllRequests(){for(let e in this.cancelControllers)this.cancelControllers[e].abort();return this.cancelControllers={},this}filter(e,s){if(!s)return e;for(let t in s){let n=s[t];switch(typeof n){case"boolean":case"number":n=""+n;break;case"string":n="'"+n.replace(/'/g,"\\'")+"'";break;default:n=n===null?"null":n instanceof Date?"'"+n.toISOString().replace("T"," ")+"'":"'"+JSON.stringify(n).replace(/'/g,"\\'")+"'"}e=e.replaceAll("{:"+t+"}",n)}return e}getFileUrl(e,s,t={}){return this.files.getUrl(e,s,t)}buildUrl(e){let s=this.baseUrl;return typeof window=="undefined"||!window.location||s.startsWith("https://")||s.startsWith("http://")||(s=window.location.origin?.endsWith("/")?window.location.origin.substring(0,window.location.origin.length-1):window.location.origin||"",this.baseUrl.startsWith("/")||(s+=window.location.pathname||"/",s+=s.endsWith("/")?"":"/"),s+=this.baseUrl),e&&(s+=s.endsWith("/")?"":"/",s+=e.startsWith("/")?e.substring(1):e),s}async send(e,s){s=this.initSendOptions(e,s);let t=this.buildUrl(e);if(this.beforeSend){const n=Object.assign({},await this.beforeSend(t,s));n.url!==void 0||n.options!==void 0?(t=n.url||t,s=n.options||s):Object.keys(n).length&&(s=n,console?.warn&&console.warn("Deprecated format of beforeSend return: please use `return { url, options }`, instead of `return options`."))}if(s.query!==void 0){const n=this.serializeQueryParams(s.query);n&&(t+=(t.includes("?")?"&":"?")+n),delete s.query}return this.getHeader(s.headers,"Content-Type")=="application/json"&&s.body&&typeof s.body!="string"&&(s.body=JSON.stringify(s.body)),(s.fetch||fetch)(t,s).then(async(n)=>{let o={};try{o=await n.json()}catch(i){}if(this.afterSend&&(o=await this.afterSend(n,o)),n.status>=400)throw new m({url:n.url,status:n.status,data:o});return o}).catch((n)=>{throw new m(n)})}initSendOptions(e,s){if((s=Object.assign({method:"GET"},s)).body=this.convertToFormDataIfNeeded(s.body),U(s),s.query=Object.assign({},s.params,s.query),s.requestKey===void 0&&(s.$autoCancel===!1||s.query.$autoCancel===!1?s.requestKey=null:(s.$cancelKey||s.query.$cancelKey)&&(s.requestKey=s.$cancelKey||s.query.$cancelKey)),delete s.$autoCancel,delete s.query.$autoCancel,delete s.$cancelKey,delete s.query.$cancelKey,this.getHeader(s.headers,"Content-Type")!==null||this.isFormData(s.body)||(s.headers=Object.assign({},s.headers,{"Content-Type":"application/json"})),this.getHeader(s.headers,"Accept-Language")===null&&(s.headers=Object.assign({},s.headers,{"Accept-Language":this.lang})),this.authStore.token&&this.getHeader(s.headers,"Authorization")===null&&(s.headers=Object.assign({},s.headers,{Authorization:this.authStore.token})),this.enableAutoCancellation&&s.requestKey!==null){const t=s.requestKey||(s.method||"GET")+e;delete s.requestKey,this.cancelRequest(t);const n=new AbortController;this.cancelControllers[t]=n,s.signal=n.signal}return s}convertToFormDataIfNeeded(e){if(typeof FormData=="undefined"||e===void 0||typeof e!="object"||e===null||this.isFormData(e)||!this.hasBlobField(e))return e;const s=new FormData;for(let t in e){const n=e[t];if(typeof n!="object"||this.hasBlobField({data:n})){const o=Array.isArray(n)?n:[n];for(let i of o)s.append(t,i)}else{let o={};o[t]=n,s.append("@jsonPayload",JSON.stringify(o))}}return s}hasBlobField(e){for(let s in e){const t=Array.isArray(e[s])?e[s]:[e[s]];for(let n of t)if(typeof Blob!="undefined"&&n instanceof Blob||typeof File!="undefined"&&n instanceof File)return!0}return!1}getHeader(e,s){e=e||{},s=s.toLowerCase();for(let t in e)if(t.toLowerCase()==s)return e[t];return null}isFormData(e){return e&&(e.constructor.name==="FormData"||typeof FormData!="undefined"&&e instanceof FormData)}serializeQueryParams(e){const s=[];for(let t in e){if(e[t]===null)continue;const n=e[t],o=encodeURIComponent(t);if(Array.isArray(n))for(let i of n)s.push(o+"="+encodeURIComponent(i));else n instanceof Date?s.push(o+"="+encodeURIComponent(n.toISOString())):typeof n!==null&&typeof n=="object"?s.push(o+"="+encodeURIComponent(JSON.stringify(n))):s.push(o+"="+encodeURIComponent(n))}return s.join("&")}}var f=new _("https://malik.pockethost.io"),ee=()=>{return u("head",null,u("title",null,"Blog"),u("link",{rel:"stylesheet",href:"/public/index.css"}))};export{ee as head,se as default};
